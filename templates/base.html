<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>{% block title %}Aura Growth - Live Your Life Like an Anime RPG{% endblock %}</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <!-- Hyperscript for animations -->
    <script src="https://unpkg.com/hyperscript.org@0.9.12"></script>
    
    <style>
        /* Custom CSS based on design.json */
        :root {
            /* Darker, more muted colors */
            --cyan: #00B4CC;
            --cyan-bright: #00D4FF;
            --cyan-dim: #006B7D;
            --teal: #008999;
            --teal-dark: #005F6B;
            --panel-dark: #0A0F1A;
            --panel-medium: #1A2332;
            --chat-dark: #1E1B3A;
            --chat-medium: #2A2554;
            --text-color: #E2E8F0;
            --inactive: #4A5568;
            --holographic: #00CED1;
            --holographic-dim: #008B8B;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0A0F1A 0%, #1A2332 100%);
            color: var(--text-color);
            min-height: 100vh;
        }
        
        .font-title {
            font-family: 'Bebas Neue', cursive;
        }
        
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Futuristic Panel Styles */
        .cyber-panel {
            background: var(--panel-dark);
            border: 1px solid var(--holographic);
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 206, 209, 0.2);
            backdrop-filter: blur(10px);
            position: relative;
        }
        
        .cyber-panel::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            background: linear-gradient(45deg, var(--holographic-dim), transparent, var(--holographic-dim));
            border-radius: 8px;
            z-index: -1;
            opacity: 0.3;
        }
        
        /* Chat Interface Styles */
        .chat-container {
            background: var(--chat-dark);
            border: 1px solid var(--teal);
            border-radius: 12px;
        }
        
        .chat-message-user {
            background: var(--teal);
            color: white;
            border-radius: 18px 18px 4px 18px;
            box-shadow: 0 2px 8px rgba(0, 180, 204, 0.3);
        }
        
        .chat-message-ai {
            background: var(--chat-medium);
            color: var(--text-color);
            border: 1px solid var(--cyan);
            border-radius: 18px 18px 18px 4px;
            box-shadow: 0 2px 8px rgba(0, 212, 255, 0.2);
        }
        
        .chat-input {
            background: var(--chat-medium);
            border: 2px solid var(--teal);
            border-radius: 24px;
            color: var(--text-color);
        }
        
        .chat-input:focus {
            border-color: var(--cyan);
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
            outline: none;
        }
        
        /* Button Styles */
        .btn-primary {
            background: var(--holographic);
            color: var(--panel-dark);
            border: none;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 206, 209, 0.3);
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .btn-primary:hover {
            background: var(--cyan-bright);
            box-shadow: 0 4px 12px rgba(0, 206, 209, 0.4);
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: transparent;
            color: var(--holographic);
            border: 1px solid var(--holographic);
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .btn-secondary:hover {
            background: var(--holographic-dim);
            color: var(--panel-dark);
            border-color: var(--holographic-dim);
        }
        
        /* Stat Bars */
        .stat-bar {
            background: var(--panel-medium);
            border: 1px solid var(--holographic-dim);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .stat-bar-fill {
            background: linear-gradient(90deg, var(--teal-dark), var(--holographic));
            height: 100%;
            transition: width 0.8s ease;
            box-shadow: 0 0 5px rgba(0, 139, 139, 0.3);
        }
        
        /* Animations */
        @keyframes glow {
            0% { box-shadow: 0 0 3px var(--holographic-dim); }
            50% { box-shadow: 0 0 8px var(--holographic-dim); }
            100% { box-shadow: 0 0 3px var(--holographic-dim); }
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        /* Line clamp utility */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        @keyframes slideIn {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        .animate-glow {
            animation: glow 2s infinite;
        }
        
        .animate-slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* XP Popup */
        .xp-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--panel-dark);
            border: 2px solid var(--cyan);
            border-radius: 8px;
            padding: 20px;
            font-size: 24px;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.3s ease-out, fadeOut 2s ease-out 1s forwards;
        }
        
        @keyframes fadeOut {
            to { opacity: 0; transform: translate(-50%, -60%); }
        }
        
        /* Glassmorphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--panel-dark);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--cyan);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--cyan-bright);
        }
        
        /* Loading spinner */
        .loading-spinner {
            border: 3px solid var(--panel-medium);
            border-top: 3px solid var(--cyan);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    
    {% block extra_head %}{% endblock %}
</head>

<body class="h-full">
    <!-- HTMX Loading Indicator -->
    <div id="loading-indicator" class="htmx-indicator fixed top-4 right-4 z-50">
        <div class="cyber-panel p-3 flex items-center space-x-2">
            <div class="loading-spinner"></div>
            <span class="text-sm font-mono">Loading...</span>
        </div>
    </div>
    
    <!-- Navigation (if user is authenticated) -->
    {% if user.is_authenticated %}
    <nav class="fixed top-0 left-0 right-0 z-40 cyber-panel m-2 md:m-4 p-3 md:p-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3 md:space-x-6">
                <a href="{% url 'dashboard' %}" class="font-title text-lg md:text-2xl text-holographic hover:text-cyan-bright transition-colors">
                    Aura Growth
                </a>
                <div class="hidden lg:flex space-x-4">
                    <a href="{% url 'dashboard' %}" class="text-gray-300 hover:text-holographic transition-colors">Dashboard</a>
                    <a href="{% url 'quests' %}" class="text-gray-300 hover:text-holographic transition-colors">Quests</a>
                    <a href="{% url 'stats' %}" class="text-gray-300 hover:text-holographic transition-colors">Stats</a>
                    <a href="{% url 'chat' %}" class="text-gray-300 hover:text-holographic transition-colors">Chat</a>
                </div>
            </div>
            <div class="flex items-center space-x-2 md:space-x-4">
                {% if user.profile %}
                <div class="text-xs md:text-sm">
                    <span class="hidden sm:inline text-gray-400">{{ user.profile.name }}</span>
                    <span class="text-holographic font-mono">LVL {{ user.profile.level }}</span>
                </div>
                {% endif %}
                <a href="{% url 'settings' %}" class="hidden md:inline text-gray-300 hover:text-holographic transition-colors">Settings</a>
                <a href="{% url 'logout' %}" class="btn-secondary px-2 py-1 md:px-4 md:py-2 text-xs md:text-sm">Logout</a>
            </div>
        </div>
        
        <!-- Mobile Navigation -->
        <div class="lg:hidden mt-3 pt-3 border-t border-gray-700">
            <div class="flex justify-center space-x-4">
                <a href="{% url 'dashboard' %}" class="text-gray-300 hover:text-holographic transition-colors text-xs">Dashboard</a>
                <a href="{% url 'quests' %}" class="text-gray-300 hover:text-holographic transition-colors text-xs">Quests</a>
                <a href="{% url 'stats' %}" class="text-gray-300 hover:text-holographic transition-colors text-xs">Stats</a>
                <a href="{% url 'chat' %}" class="text-gray-300 hover:text-holographic transition-colors text-xs">Chat</a>
                <a href="{% url 'settings' %}" class="text-gray-300 hover:text-holographic transition-colors text-xs">Settings</a>
            </div>
        </div>
    </nav>
    {% endif %}
    
    <!-- Main Content -->
    <main class="{% if user.is_authenticated %}pt-32 lg:pt-24{% endif %} min-h-screen">
        {% block content %}{% endblock %}
    </main>
    
    <!-- XP Notification Container -->
    <div id="xp-notifications" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 pointer-events-none"></div>
    
    <!-- HTMX Scripts -->
    <script>
        // Global HTMX configuration
        htmx.config.globalViewTransitions = true;
        
        // Configure HTMX to include CSRF token in all requests
        document.addEventListener('htmx:configRequest', function(evt) {
            const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            evt.detail.headers['X-CSRFToken'] = csrfToken;
        });
        
        // Custom HTMX events
        document.addEventListener('htmx:beforeSwap', function(evt) {
            if (evt.detail.xhr.status === 404) {
                evt.detail.shouldSwap = false;
                showNotification('Error: Page not found', 'error');
            }
        });
        
        // Show XP gain notification
        function showXPGain(amount, statGains) {
            const container = document.getElementById('xp-notifications');
            const notification = document.createElement('div');
            notification.className = 'xp-popup animate-slide-in';
            
            let content = `+${amount} XP!`;
            if (statGains && Object.keys(statGains).length > 0) {
                const statText = Object.entries(statGains)
                    .filter(([stat, gain]) => gain > 0)
                    .map(([stat, gain]) => `+${gain} ${stat.toUpperCase()}`)
                    .join(', ');
                if (statText) {
                    content += `<br><span class="text-lg">${statText}</span>`;
                }
            }
            
            notification.innerHTML = content;
            container.appendChild(notification);
            
            // Remove after animation
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        
        // Show level up notification
        function showLevelUp(newLevel) {
            const container = document.getElementById('xp-notifications');
            const notification = document.createElement('div');
            notification.className = 'xp-popup animate-slide-in text-cyan-400';
            notification.innerHTML = `
                <div class="text-3xl font-title">LEVEL UP!</div>
                <div class="text-xl">Level ${newLevel}</div>
                <div class="text-sm">All stats increased!</div>
            `;
            container.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 4000);
        }
        
        // Generic notification system
        function showNotification(message, type = 'info') {
            const container = document.getElementById('xp-notifications');
            const notification = document.createElement('div');
            const colors = {
                'info': 'border-cyan-400 text-cyan-400',
                'success': 'border-green-400 text-green-400',
                'error': 'border-red-400 text-red-400',
                'warning': 'border-yellow-400 text-yellow-400'
            };
            
            notification.className = `cyber-panel p-4 ${colors[type] || colors.info} animate-slide-in`;
            notification.innerHTML = message;
            container.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        
        // Listen for custom HTMX events
        document.addEventListener('quest-completed', function(evt) {
            const detail = evt.detail;
            if (detail.xp_gained) {
                showXPGain(detail.xp_gained, detail.stat_gains);
            }
            if (detail.level_up) {
                showLevelUp(detail.new_level);
            }
        });
        
        // Auto-refresh functionality for dashboard
        if (window.location.pathname === '/dashboard/') {
            setInterval(() => {
                htmx.trigger('#stats-container', 'refreshStats');
            }, 30000); // Refresh every 30 seconds
        }
    </script>
    
    {% block extra_scripts %}{% endblock %}
</body>
</html> 